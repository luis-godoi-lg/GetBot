<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="GestaoChamados.Mobile.Views.GerenciarUsuariosPage"
             Title="Gerenciar Usuários"
             Shell.NavBarIsVisible="False"
             BackgroundColor="#F5F6FA">

    <Grid RowDefinitions="Auto,*">
        
        <!-- Header -->
        <Border Grid.Row="0" BackgroundColor="#0066CC" Padding="12,12">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <Button Grid.Column="0"
                        Text="←"
                        TextColor="White"
                        BackgroundColor="Transparent"
                        FontSize="22"
                        Padding="0"
                        WidthRequest="36"
                        Clicked="OnVoltarClicked"/>
                
                <Label Grid.Column="1"
                       Text="👥 Usuários"
                       TextColor="White"
                       FontSize="18"
                       FontAttributes="Bold"
                       VerticalOptions="Center"
                       Margin="8,0,0,0"/>
                
                <Button Grid.Column="2"
                        Text="+ Novo"
                        TextColor="White"
                        BackgroundColor="#10B981"
                        FontSize="12"
                        Padding="10,6"
                        CornerRadius="6"
                        FontAttributes="Bold"
                        Clicked="OnNovoUsuarioClicked"/>
            </Grid>
        </Border>

        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="12" Padding="12">
                
                <!-- Filtro -->
                <Border BackgroundColor="White" Padding="12" StrokeThickness="0"
                        StrokeShape="RoundRectangle 10">
                    <Border.Shadow>
                        <Shadow Brush="Black" Opacity="0.1" Radius="8" Offset="0,2"/>
                    </Border.Shadow>
                    <Grid ColumnDefinitions="Auto,*">
                        <Label Grid.Column="0" Text="🔍" FontSize="16" TextColor="#666" VerticalOptions="Center" Margin="0,0,8,0"/>
                        <Picker Grid.Column="1" x:Name="FiltroPicker" 
                                Title="Filtrar"
                                BackgroundColor="#F9FAFB"
                                TextColor="#333"
                                FontSize="12"
                                SelectedIndexChanged="OnFiltroChanged">
                            <Picker.Items>
                                <x:String>Todos</x:String>
                                <x:String>Admin</x:String>
                                <x:String>Tecnico</x:String>
                                <x:String>Usuario</x:String>
                            </Picker.Items>
                        </Picker>
                    </Grid>
                </Border>

                <!-- Lista de Usuários -->
                <CollectionView x:Name="UsuariosCollectionView" SelectionMode="None">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Border BackgroundColor="White" Padding="14" Margin="0,0,0,8" StrokeThickness="0"
                                    StrokeShape="RoundRectangle 10">
                                <Border.Shadow>
                                    <Shadow Brush="Black" Opacity="0.1" Radius="8" Offset="0,2"/>
                                </Border.Shadow>
                                <Grid RowDefinitions="Auto,Auto,Auto,Auto" RowSpacing="6">
                                    
                                    <!-- Nome e Badge de Role -->
                                    <HorizontalStackLayout Grid.Row="0" Spacing="8" VerticalOptions="Center">
                                        <Label Text="{Binding Nome}" FontSize="15" FontAttributes="Bold" TextColor="#333" VerticalOptions="Center"/>
                                        <Border BackgroundColor="{Binding RoleColor}" Padding="8,4" StrokeThickness="0"
                                                StrokeShape="RoundRectangle 6" VerticalOptions="Center">
                                            <HorizontalStackLayout Spacing="3">
                                                <Label Text="{Binding RoleEmoji}" FontSize="10" TextColor="White" FontAttributes="Bold" VerticalOptions="Center"/>
                                                <Label Text="{Binding Role}" FontSize="10" TextColor="White" FontAttributes="Bold" VerticalOptions="Center"/>
                                            </HorizontalStackLayout>
                                        </Border>
                                    </HorizontalStackLayout>
                                    
                                    <!-- Email -->
                                    <HorizontalStackLayout Grid.Row="1" Spacing="4">
                                        <Label Text="📧" FontSize="11" VerticalOptions="Center"/>
                                        <Label Text="{Binding Email}" FontSize="11" TextColor="#666" LineBreakMode="TailTruncation" VerticalOptions="Center"/>
                                    </HorizontalStackLayout>
                                    
                                    <!-- Data de Criação -->
                                    <HorizontalStackLayout Grid.Row="2" Spacing="4">
                                        <Label Text="📅" FontSize="11" VerticalOptions="Center"/>
                                        <Label Text="{Binding DataCriacaoFormatada}" FontSize="10" TextColor="#999" VerticalOptions="Center"/>
                                    </HorizontalStackLayout>
                                    
                                    <!-- Botões de Ação -->
                                    <Grid Grid.Row="3" ColumnDefinitions="*,*" ColumnSpacing="8" Margin="0,4,0,0">
                                        <Button Grid.Column="0"
                                                Text="✏️ Editar" 
                                                BackgroundColor="#2563EB" 
                                                TextColor="White"
                                                FontSize="11"
                                                HeightRequest="36"
                                                CornerRadius="6"
                                                Clicked="OnEditarClicked"
                                                CommandParameter="{Binding}"/>
                                        <Button Grid.Column="1"
                                                Text="🗑️ Excluir" 
                                                BackgroundColor="#EF4444" 
                                                TextColor="White"
                                                FontSize="11"
                                                HeightRequest="36"
                                                CornerRadius="6"
                                                Clicked="OnExcluirClicked"
                                                CommandParameter="{Binding}"/>
                                    </Grid>
                                    
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>